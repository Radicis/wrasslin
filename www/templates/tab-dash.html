<ion-view view-title="Wrasslin">
  <ion-nav-buttons side="right">
    <button ng-if="!loggedIn" class="button" ng-click="login()">
      Log In
    </button>
    <button ng-if="loggedIn" class="button" ng-click="logout()">
     Log Out
    </button>
  </ion-nav-buttons>
  <ion-content>
    <ion-list>
    <div ng-repeat="event in events | orderBy: '-date'" ng-init="getMatches(event)">
      <ion-item class="item-stable"
      ng-click="toggleGroup(event)"
      ng-class="{active: isGroupShown(event)}" type="item-text-wrap" >
        <h2>{{event.name}}</h2>
        <p>{{event.date | date:dateFormat}}</p>
        <div class="padding">
          <p ng-repeat="points in event.userPoints | orderBy: 'points.points'">{{points.name}} : {{points.points}} points</p>
        </div>
          <ion-item class="item-accordion padding center" ng-repeat="match in event.matches | orderBy: '-date'" type="item-text-wrap" ng-show="isGroupShown(event)">
              <h2 class="title padding">
                <span ng-class="{'isWinner': match.winner==match.p1}">{{match.p1}}</span> vs <span ng-class="{'isWinner': match.winner==match.p2}">{{match.p2}}</span></h2>
            <button ng-if=match.active class="button button-positive" ng-click="setWinner(match, event)">Match Over</button>
            <div class="row">
              <div  ng-repeat="vote in match.votes" class="col">
                <strong>{{vote.name}}</strong> voted for <strong>{{vote.vote}}</strong>
              </div>
            </div>
            <div ng-if="match.active && loggedIn && !hasUserVoted(match)">
              <button class="button button-block button-positive" ng-click="vote(event.$id, match.$id, match.p1)">
                {{match.p1}}
              </button>
              VS
              <button class="button button-block button-positive" ng-click="vote(event.$id, match.$id, match.p2)">
                {{match.p2}}
              </button>
            </div>
        </ion-item>
      </ion-item>
  </div>
  </ion-list>
  </ion-content>
</ion-view>
